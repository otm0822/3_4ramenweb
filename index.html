<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>ğŸœ ì§€í˜œë¡œìš´ ë¼ë©´ ğŸœ</title>
  <style>
    * { box-sizing: border-box; }
    html, body { height: 100%; margin: 0; }
    body {
      display: flex; flex-direction: column;
      font-family: sans-serif; padding: 1rem;
    }
    h1 { text-align: center; margin-bottom: 1rem; }

    /* ì£¼ë¬¸ ìœ í˜• í† ê¸€ ë””ìì¸ */
    #orderTypeToggle {
      display: flex;
      justify-content: center;
      margin-bottom: 1rem;
    }
    #orderTypeToggle label {
      flex: 1;
      padding: 0.5rem;
      text-align: center;
      border: 1px solid #007bff;
      border-radius: 4px;
      cursor: pointer;
      user-select: none;
      font-weight: bold;
      color: #007bff;
      transition: background 0.2s, color 0.2s;
    }
    #orderTypeToggle input {
      display: none;
    }
    #orderTypeToggle input:checked + label {
      background: #007bff;
      color: #fff;
    }
    #orderTypeToggle label + label {
      margin-left: 0.5rem;
    }

    /* ë©”ë‰´ ê·¸ë¦¬ë“œ */
    .grid {
      flex: 1;
      display: grid;
      grid-template-columns: repeat(2, minmax(120px, 1fr));
      grid-auto-rows: 1fr;
      gap: 1rem;
      max-width: 600px;
      margin: 0 auto;
      align-content: space-around;
    }
    .card {
      background: #fff; border: 1px solid #ddd;
      border-radius: 8px; padding: 0.5rem;
      box-shadow: 0 2px 5px rgba(0,0,0,0.1);
      display: flex; flex-direction: column;
      justify-content: space-between;
      cursor: pointer; height: 100%;
    }
    .card img {
      flex: 1; width: 100%;
      object-fit: cover; border-radius: 4px;
    }
    .caption {
      margin: 0.5rem 0 1rem;
      text-align: center; font-weight: bold;
      font-size: 0.9rem;
    }

    /* ì¹´íŠ¸ ìš”ì•½(ê³ ì • í‘¸í„°) */
    #cartSummary {
      position: fixed; bottom: 0; left: 0; right: 0;
      background: #fff; border-top: 1px solid #ddd;
      padding: 0.5rem 1rem;
      display: flex; justify-content: space-between;
      align-items: center; z-index: 999;
    }
    #cartSummary button {
      padding: 0.4rem 0.8rem; cursor: pointer;
      background: #007bff; color: #fff; border: none;
      border-radius: 4px;
    }

    /* ì£¼ë¬¸ ëª¨ë‹¬ */
    .modal { display: none; position: fixed;
      top: 0; left: 0; right: 0; bottom: 0;
      background: rgba(0,0,0,0.6);
      align-items: center; justify-content: center;
      padding: 1rem;
    }
    .modal.open { display: flex; }
    .modal-content {
      background: #fff; padding: 1rem;
      border-radius: 8px; width: 100%; max-width: 360px;
    }
    .modal-content h2 { margin-top: 0; text-align: center; }

    /* Step1, Step2, Confirm */
    .toppings {
      border-top: 1px solid #eee;
      margin: 0.5rem 0; max-height: 150px;
      overflow-y: auto;
    }
    .topping-option {
      display: flex; justify-content: space-between;
      padding: 0.4rem 0; border-bottom: 1px solid #f0f0f0;
      font-size: 0.9rem;
    }
    .quantity {
      display: flex; justify-content: center;
      align-items: center; gap: 0.5rem; margin: 0.5rem 0;
    }
    .quantity button { width: 32px; height: 32px; font-size: 1.2rem; }
    .order-summary { display: flex; justify-content: space-between; align-items: center; }
    #totalPrice { font-weight: bold; }
    #addToCart, #confirmOrder { width: 100%; padding: 0.5rem; margin-top: 0.5rem; border: none; border-radius: 4px; cursor: pointer; }
    #addToCart { background: #28a745; color: #fff; }
    #confirmOrder { background: #007bff; color: #fff; }

    #step2 input { width: 100%; padding: 0.4rem; margin-bottom: 0.6rem; }
    #step2 p { font-size: 0.9rem; margin-bottom: 0.5rem; color: #555; }

    /* í™•ì¸ ëª¨ë‹¬ */
    #confirmModal .modal-content { max-width: 400px; }
    #confirmList { max-height: 200px; overflow-y: auto; margin-bottom: 1rem; }
    #confirmList li { margin-bottom: 0.4rem; }
    #confirmModal button { width: 48%; padding: 0.4rem; margin-right: 2%; }
    #confirmModal button:last-child { margin-right: 0; }
  </style>
</head>
<body>
  <h1>ğŸœ ì§€í˜œë¡œìš´ ë¼ë©´ ğŸœ</h1>

  <!-- ì£¼ë¬¸ ìœ í˜• í† ê¸€ -->
  <div id="orderTypeToggle">
    <input type="radio" id="t-delivery" name="orderType" value="delivery" checked />
    <label for="t-delivery">ë°°ë‹¬</label>
    <input type="radio" id="t-dinein" name="orderType" value="dinein" />
    <label for="t-dinein">ë§¤ì¥</label>
  </div>

  <div class="grid" id="menuGrid"></div>

  <div id="cartSummary">
    <span id="cartCount">0ê°œ</span> |
    <span id="cartTotal">0ì›</span>
    <button id="checkoutBtn">ì£¼ë¬¸í•˜ê¸°</button>
  </div>

  <!-- Step1 & Step2 ëª¨ë‹¬ (orderModal) -->
  <div class="modal" id="orderModal">
    <div class="modal-content">
      <h2 id="modalTitle">ë©”ë‰´ëª…</h2>
      <!-- Step1 -->
      <div id="step1">
        <div class="toppings" id="toppingsBox"></div>
        <div class="quantity">
          <button id="decQty">â€“</button>
          <span id="qtyLabel">1</span>
          <button id="incQty">+</button>
        </div>
        <div class="order-summary">
          <div id="totalPrice">0ì›</div>
          <button id="addToCart">ë‹´ê¸°</button>
        </div>
      </div>
      <!-- Step2 -->
      <div id="step2">
        <p id="orderHint"></p>
        <input type="text" id="infoInput" placeholder="í…Œì´ë¸” ë²ˆí˜¸ ë˜ëŠ” ìˆ˜ë ¹ì¸ ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”" />
        <input type="text" id="addrInput" placeholder="ë°°ë‹¬ ì£¼ì†Œë¥¼ ì…ë ¥í•˜ì„¸ìš”" />
        <button id="confirmOrder">í™•ì¸</button>
      </div>
    </div>
  </div>

  <!-- í™•ì¸ ëª¨ë‹¬ -->
  <div class="modal" id="confirmModal">
    <div class="modal-content">
      <h2>ì£¼ë¬¸ ë‚´ì—­ í™•ì¸</h2>
      <ul id="confirmList"></ul>
      <button id="cancelConfirm">ì·¨ì†Œ</button>
      <button id="okConfirm">í™•ì¸</button>
    </div>
  </div>

  <script>
    const menu = [
      {name:'ê¸°ë³¸ ë¼ë©´',img:'images/jiheramen.jpeg',price:4000},
      {name:'ì¹˜ì¦ˆ ë¼ë©´',img:'images/cheese_ramen.jpg',price:4500},
      {name:'ë–¡ ë¼ë©´',  img:'images/tteok_ramen.jpg',  price:4500},
      {name:'ë§Œë‘ ë¼ë©´',img:'images/mandu_ramen.jpg',  price:4500},
      {name:'ëœë¤ ë¼ë©´',img:'images/random.jpeg',      price:4300},
      {name:'í–‡ë°˜',     img:'images/haetban.jpg',      price:1500}
    ];
    const toppingsData={ê³„ë€:700,íŒŒ:700,ê¹€ì¹˜:700};

    let selectedDish, basePrice, qty;
    const cart=[];

    // dom
    const menuGrid       = document.getElementById('menuGrid');
    const orderTypeToggle= document.getElementById('orderTypeToggle');
    const cartCount      = document.getElementById('cartCount');
    const cartTotal      = document.getElementById('cartTotal');
    const checkoutBtn    = document.getElementById('checkoutBtn');
    const orderModal     = document.getElementById('orderModal');
    const confirmModal   = document.getElementById('confirmModal');
    const modalTitle     = document.getElementById('modalTitle');
    const toppingsBox    = document.getElementById('toppingsBox');
    const decQty         = document.getElementById('decQty');
    const incQty         = document.getElementById('incQty');
    const qtyLabel       = document.getElementById('qtyLabel');
    const totalPrice     = document.getElementById('totalPrice');
    const addToCart      = document.getElementById('addToCart');
    const step1          = document.getElementById('step1');
    const step2          = document.getElementById('step2');
    const orderHint      = document.getElementById('orderHint');
    const infoInput      = document.getElementById('infoInput');
    const addrInput      = document.getElementById('addrInput');
    const confirmOrder   = document.getElementById('confirmOrder');
    const confirmList    = document.getElementById('confirmList');
    const cancelConfirm  = document.getElementById('cancelConfirm');
    const okConfirm      = document.getElementById('okConfirm');

    function updateTotal(){
      const tsum= Array.from(toppingsBox.querySelectorAll('input:checked'))
        .map(cb=>toppingsData[cb.value]).reduce((a,b)=>a+b,0);
      totalPrice.textContent = ((basePrice+tsum)*qty).toLocaleString() + 'ì›';
    }
    function updateCartSummary(){
      const count= cart.reduce((s,o)=>s+o.quantity,0);
      const price= cart.reduce((s,o)=>{
        const base= menu.find(m=>m.name===o.item).price;
        const tsum= o.toppings.reduce((a,t)=>a+toppingsData[t],0);
        return s+(base+tsum)*o.quantity;
      },0);
      cartCount.textContent = count+'ê°œ';
      cartTotal.textContent = price.toLocaleString()+'ì›';
    }

    // ë©”ë‰´ ë Œë”
    menu.forEach((it,i)=>{
      const c=document.createElement('div'); c.className='card';
      c.innerHTML=`<img src='${it.img}' data-i='${i}'/><div class='caption'>${it.name}</div>`;
      menuGrid.append(c);
    });

    // ì¹´ë“œ í´ë¦­
    menuGrid.onclick=e=>{
      if(e.target.tagName!=='IMG') return;
      const it= menu[+e.target.dataset.i];
      selectedDish=it.name; basePrice=it.price; qty=1;
      modalTitle.textContent=selectedDish;
      toppingsBox.innerHTML=Object.keys(toppingsData).map(n=>
        `<label><input type='checkbox' value='${n}'/>${n}(+${toppingsData[n]}ì›)</label>`
      ).join('');
      qtyLabel.textContent=qty; updateTotal();
      step1.style.display='block'; step2.style.display='none';
      orderModal.classList.add('open');
      orderHint.textContent=''; infoInput.value=''; addrInput.value='';
      document.querySelectorAll('#toppingsBox input')
        .forEach(cb=>cb.onchange=updateTotal);
    };
    decQty.onclick=()=>{if(qty>1)qty--; qtyLabel.textContent=qty; updateTotal();};
    incQty.onclick=()=>{qty++; qtyLabel.textContent=qty; updateTotal();};

    // ë‹´ê¸°
    addToCart.onclick=()=>{
      const tops=Array.from(toppingsBox.querySelectorAll('input:checked')).map(cb=>cb.value);
      cart.push({item:selectedDish,quantity:qty,toppings:tops});
      updateCartSummary(); orderModal.classList.remove('open');
    };

    // í™•ì¸ ëª¨ë‹¬ ë„ìš°ê¸°
    checkoutBtn.onclick=()=>{
      if(cart.length===0){alert('â— ë¨¼ì € ë©”ë‰´ë¥¼ ë‹´ì•„ì£¼ì„¸ìš”');return;}
      confirmList.innerHTML=cart.map(o=>
        `<li>${o.item} x${o.quantity} ${o.toppings.join(',')}</li>`
      ).join('');
      confirmModal.classList.add('open');
    };
    cancelConfirm.onclick=()=> confirmModal.classList.remove('open');
    okConfirm.onclick=()=>{
      confirmModal.classList.remove('open');
      // Step2 ì„¤ì •
      const type=document.querySelector('input[name="orderType"]:checked').value;
      if(type==='dinein'){
        orderHint.textContent='ğŸ“ í…Œì´ë¸” ë²ˆí˜¸ ë˜ëŠ” ìˆ˜ë ¹ì¸ ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”.';
        infoInput.style.display='block'; addrInput.style.display='none';
      } else {
        orderHint.textContent='' ;
        infoInput.style.display='none'; addrInput.style.display='block';
      }
      step1.style.display='none'; step2.style.display='block';
    };

    // ìµœì¢… ì£¼ë¬¸
    confirmOrder.onclick=()=>{
      const type=document.querySelector('input[name="orderType"]:checked').value;
      let del,addr;
      if(type==='dinein'){ del=addr=infoInput.value.trim(); }
      else{ del=delivererInput.value.trim(); addr=addrInput.value.trim(); }
      if(!del){alert('â— ì…ë ¥ì„ ì™„ë£Œí•´ì£¼ì„¸ìš”.');return;}
      cart.forEach(o=>fetch('/api/orders',{
        method:'POST',headers:{'Content-Type':'application/json'},
        body:JSON.stringify({
          item:o.item,quantity:o.quantity,
          toppings:o.toppings,deliverer:del,
          address:addr,orderType:type
        })
      }));
      alert('âœ… ì£¼ë¬¸ ì™„ë£Œ!'); cart.length=0; updateCartSummary(); orderModal.classList.remove('open');
    };

    // ëª¨ë‹¬ ë‹«ê¸°
    document.querySelectorAll('.modal').forEach(m=>
      m.onclick=e=>{if(e.target===m)m.classList.remove('open');}
    );

    document.getElementById('adminBtn').onclick=()=>{
      const pw=prompt('ê´€ë¦¬ì ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”:');
      if(pw==='admin123')location.href='/admin';
      else alert('âŒ ë¹„ë°€ë²ˆí˜¸ê°€ í‹€ë ¸ìŠµë‹ˆë‹¤');
    };
  </script>
</body>
</html>
